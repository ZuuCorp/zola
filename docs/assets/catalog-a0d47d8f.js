class t{constructor(){this.tracks=[],this.albums=[],this.artistId=null,this.artistName="Zola",this.artistViewUrl=null,this.source="itunes"}async init(){try{await this.detectArtistId(this.artistName),this.artistId?(await this.fetchLookupAlbums(this.artistId),await this.fetchLookupTracks(this.artistId)):(await this.fetchItunesAlbums("Zola rap FR"),await this.fetchItunesTracks("Zola rap FR")),this.dispatchEvent("catalog:loaded",{total:this.tracks.length,albums:this.albums.length,artistId:this.artistId,artistViewUrl:this.artistViewUrl})}catch(t){}}async detectArtistId(t){try{const e=`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&entity=musicArtist&limit=10&country=FR`,a=await fetch(e,{mode:"cors"});if(!a.ok)return;const r=((await a.json()).results||[]).filter(t=>"zola"===(t.artistName||"").toLowerCase());if(0===r.length)return;const i=["Cicatrices","Survie","Diamant du Bled"];let s={id:null,score:-1,viewUrl:null};for(const t of r){const e=t.artistId,a=`https://itunes.apple.com/lookup?id=${e}&entity=album&limit=200&country=FR`,r=await fetch(a,{mode:"cors"});if(!r.ok)continue;const o=((await r.json()).results||[]).filter(t=>"collection"===t.wrapperType),l=new Set(o.map(t=>(t.collectionName||"").toLowerCase())),c=i.reduce((t,e)=>t+(l.has(e.toLowerCase())?1:0),0);c>s.score&&(s={id:e,score:c,viewUrl:t.artistLinkUrl||t.artistViewUrl||null})}s.id&&(this.artistId=s.id,this.artistViewUrl=s.viewUrl)}catch(e){}}async fetchLookupAlbums(t){const e=`https://itunes.apple.com/lookup?id=${t}&entity=album&limit=200&country=FR`,a=await fetch(e,{mode:"cors"});if(!a.ok)return;const r=await a.json();this.albums=(r.results||[]).filter(t=>"collection"===t.wrapperType).map(t=>({id:t.collectionId,title:t.collectionName,cover:(t.artworkUrl100||"").replace("100x100bb","600x600bb"),url:t.collectionViewUrl,artist:t.artistName,releaseDate:t.releaseDate}))}async fetchLookupTracks(t){const e=`https://itunes.apple.com/lookup?id=${t}&entity=song&limit=200&country=FR`,a=await fetch(e,{mode:"cors"});if(!a.ok)return;const r=await a.json();this.tracks=(r.results||[]).filter(t=>"track"===t.wrapperType).map(t=>({id:t.trackId,title:t.trackName,album:t.collectionName,artist:t.artistName,cover:(t.artworkUrl100||"").replace("100x100bb","600x600bb"),previewUrl:t.previewUrl,genre:t.primaryGenreName,releaseDate:t.releaseDate})).filter(t=>!!t.previewUrl)}async fetchItunesAlbums(t){const e=`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&entity=album&limit=20&country=FR`,a=await fetch(e,{mode:"cors"});if(!a.ok)return;const r=await a.json();this.albums=(r.results||[]).filter(t=>"Album"===t.collectionType).map(t=>({id:t.collectionId,title:t.collectionName,cover:(t.artworkUrl100||"").replace("100x100bb","600x600bb"),url:t.collectionViewUrl,artist:t.artistName,releaseDate:t.releaseDate}))}async fetchItunesTracks(t){const e=`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&entity=song&limit=100&country=FR`,a=await fetch(e,{mode:"cors"});if(!a.ok)return;const r=await a.json();this.tracks=(r.results||[]).map(t=>({id:t.trackId,title:t.trackName,album:t.collectionName,artist:t.artistName,cover:(t.artworkUrl100||"").replace("100x100bb","600x600bb"),previewUrl:t.previewUrl,genre:t.primaryGenreName,releaseDate:t.releaseDate})).filter(t=>!!t.previewUrl)}getTracks(){return this.tracks}getAlbums(){return this.albums}dispatchEvent(t,e={}){const a=new CustomEvent(t,{detail:{...e,timestamp:Date.now()}});window.dispatchEvent(a)}}export{t as W};
